---
title: Mimikatz::Lsadump
description: LSADump Module Reference
published: true
date: 2025-10-08T15:29:42.007Z
tags: mimikatz
editor: markdown
dateCreated: 2025-10-08T15:29:42.007Z
---

# Mimikatz::LSADump

`lsadump` Module Reference

The `lsadump` module extracts or manipulates secrets that the Local Security Authority (LSA) and
related directory services maintain. The commands below are documented in the order they are
registered in the module table so that the CLI syntax mirrors the implementation.

Each subsection summarizes the goal of the command, lists the accepted flags, and explains why you
would use each option in practice. Unless noted otherwise, commands default to operating on the
local machine using the live registry and LSASS process.

## `lsadump::sam`
Reads the SAM database and decrypts local account password hashes. It can operate online or against
exported hive files.

| Flag | Purpose | Why use it |
| --- | --- | --- |
| `/system:<path>` | Opens an offline SYSTEM hive and derives the SysKey from it. | Required when dumping hashes from offline hives where LSASS is not available; also allows point-in-time analysis. |
| `/sam:<path>` | Opens an offline SAM hive that pairs with the supplied SYSTEM hive. | Lets you read SAM data from another installation or from backup copies. |

Without flags the command opens the local registry and queries `HKLM\SYSTEM` and `HKLM\SAM`
through the registry APIs.【F:mimikatz/modules/kuhl_m_lsadump.c†L32-L90】

## `lsadump::secrets`
Retrieves LSA secrets such as service account passwords and DPAPI master keys. Works online or with
exported hives.

| Flag | Purpose | Why use it |
| --- | --- | --- |
| `/system:<path>` | Loads an offline SYSTEM hive to recover the SysKey needed to decrypt secrets. | Essential when analyzing another system’s hives offline. |
| `/security:<path>` | Loads an offline SECURITY hive that contains the LSA secrets. | Required when decrypting secrets from offline registry copies. |

When no path is supplied, the command reads the local `HKLM\SYSTEM` and `HKLM\SECURITY`
keys to obtain the SysKey and the encrypted secrets before decrypting them in place.【F:mimikatz/modules/kuhl_m_lsadump.c†L103-L220】

## `lsadump::cache`
Extracts cached domain logon data (`NL$KM` and DCC credentials) and optionally replaces entries for a
specific user. Accepts all parameters from `lsadump::secrets` plus additional cache controls.

| Flag | Purpose | Why use it |
| --- | --- | --- |
| `/system:<path>` | Load an offline SYSTEM hive to derive the SysKey. | Needed when working with offline registry dumps. |
| `/security:<path>` | Load an offline SECURITY hive that stores cached credentials. | Required when modifying or reading caches from offline data. |
| `/user:<name>` | Enable “cache replace” mode for a specific user. | Allows injecting custom cache material for testing or persistence. |
| `/dcc:<hex>` | Provide a hexadecimal DCC hash to insert for the chosen user. | Supplies a pre-computed DCC hash when you do not want to derive it from a password. |
| `/ntlm:<hex>` | Provide an NTLM hash that will be turned into a DCC entry. | Useful when you only have the NTLM hash of the user. |
| `/password:<string>` | Let the tool derive the NTLM hash from a clear-text password. | Handy when you know the password but not the hash. |
| `/subject:<CN>` | Open the current user certificate store and acquire the private key of the certificate whose subject matches `<CN>`. | Required to decrypt machine-bound cache data that is protected by a smart-card or certificate private key. |

The command builds the appropriate crypto context depending on the supplied arguments before
reading or editing the cached credentials.【F:mimikatz/modules/kuhl_m_lsadump.c†L103-L213】

## `lsadump::lsa`
Queries the SAM service through LSASS to extract user password data or supplemental credentials. The
command supports multiple access strategies to work around protections.

| Flag | Purpose | Why use it |
| --- | --- | --- |
| `/patch` | Patches `samsrv.dll` in LSASS to bypass security checks before retrying the dump. | Helps when direct RPC calls are blocked by hardening; performs a just-in-time in-memory patch. |
| `/inject` | Injects a helper thread into LSASS that executes the extraction logic. | Useful when patching is not possible but you can run code in LSASS. |
| `/id:<rid>` | Target a specific RID (relative identifier). | Focuses on a single account when you already know the RID. |
| `/name:<user>` or `/user:<user>` | Target a specific account by name. | Dumps credentials for one account without enumerating the entire domain. |

Without filters the command enumerates every user in the SAM domain and displays their password
hashes and supplemental credentials.【F:mimikatz/modules/kuhl_m_lsadump.c†L1320-L1517】

## `lsadump::trust`
Lists trust relationships and extracts the shared keys used between domains.

| Flag | Purpose | Why use it |
| --- | --- | --- |
| `/patch` | Temporarily patches LSASS trust routines before retrying. | Required on hardened builds where trust APIs refuse to return secrets. |
| `/system:<hostname>` | Perform the policy lookup on a remote system instead of the local computer. | Allows querying trust data from another domain controller when run with the proper rights. |

If patching is not requested the command opens the target LSA policy and enumerates every trusted
domain, printing inbound and outbound authentication information as well as historical values.【F:mimikatz/modules/kuhl_m_lsadump.c†L1695-L1857】

## `lsadump::backupkeys`
Fetches domain backup keys (`G$BCKUPKEY_*`) and optionally exports them to files for later DPAPI
operations.

| Flag | Purpose | Why use it |
| --- | --- | --- |
| `/guid:<GUID>` | Retrieve a specific backup key by GUID. | Lets you pull non-preferred keys directly when you already know their identifier. |
| `/system:<hostname>` | Query a remote LSA instance instead of the local machine. | Enables pulling backup keys from another domain controller. |
| `/export` | Write the recovered material to disk in addition to printing it. | Creates `.pfx`, `.der`, or `.key` files that can be reused by DPAPI tooling. |
| `/secret` | Use the `LsaRetrievePrivateData` secret API path. | Necessary when remote policy handles require the secret flag. |

Without `/guid` the command first resolves the preferred and legacy GUIDs before retrieving and
analyzing each key, exporting when requested.【F:mimikatz/modules/kuhl_m_lsadump.c†L1945-L2012】

## `lsadump::rpdata`
Reads arbitrary LSA private data blobs by name.

| Flag | Purpose | Why use it |
| --- | --- | --- |
| `/name:<SecretName>` | The registry secret to retrieve. | Mandatory: identifies which LSA private data to dump. |
| `/system:<hostname>` | Query a remote LSA instance. | Use when the secret lives on another host. |
| `/secret` | Request the data via the secret API. | Required for some remote retrieval scenarios. |
| `/export` | Reserved for future export support (currently unused). | Included for completeness; no additional action today. |

If the secret is found its raw bytes are printed in hexadecimal form.【F:mimikatz/modules/kuhl_m_lsadump.c†L1997-L2012】

## `lsadump::dcsync`
Uses the DRS replication protocol to request password data for directory objects from a domain
controller.

| Flag | Purpose | Why use it |
| --- | --- | --- |
| `/domain:<fqdn>` | Target a specific Active Directory domain. | Required when the current logon domain is not the one you want to replicate. |
| `/dc:<fqdn>` or `/kdc:<fqdn>` | Choose the domain controller to contact. | Ensures the request hits a reachable controller or one with particular replication data. |
| `/user:<samAccountName>` | Replicate a single account by name. | Typical case for extracting a specific user or the krbtgt account. |
| `/guid:<GUID>` | Replicate by object GUID instead of name. | Useful when the object has been renamed or you want to avoid ambiguity. |
| `/all` | Iterate through objects and dump the entire domain. | Performs a full replication-style dump for large-scale analysis. |
| `/export` | Request export-friendly attribute selection. | Limits replication to attributes that are safe to write to disk. |
| `/csv` | Print results in CSV format. | Simplifies automated parsing. |
| `/deleted` | Include deleted objects. | Important when hunting for lingering deleted accounts. |
| `/uac` | Decode the `userAccountControl` flag to human-readable form. | Helps interpret account status quickly. |
| `/laps` | Resolve the attribute IDs for LAPS-managed passwords. | Necessary before requesting managed local administrator passwords. |
| `/authntlm` | Force NTLM authentication for the RPC binding. | Use when Kerberos/Negotiate is unavailable but NTLM is acceptable. |

Connection fine-tuning inherited from the RPC helper is also available: `/service`, `/altservice`,
`/protseq`, `/endpoint`, `/noauth`, `/ntlm`, `/kerberos`, `/negotiate`, `/null`, `/authuser`,
`/authdomain`, and `/authpassword` let you control the RPC binding and authentication context when
Kerberos defaults are unsuitable.【F:mimikatz/modules/lsadump/kuhl_m_lsadump_dc.c†L33-L202】【F:modules/rpc/kull_m_rpc.c†L147-L215】

## `lsadump::dcshadow`
Implements DCShadow to register a rogue domain controller, push custom replication metadata, or
manage staged modifications.

| Flag | Purpose | Why use it |
| --- | --- | --- |
| `/stack` | Add the supplied object/attribute/value triplet to the in-memory request stack. | Build multi-step changes before interacting with a real DC. |
| `/viewstack` | Display the currently stacked changes. | Review pending modifications for accuracy. |
| `/clearstack` | Delete all stacked changes. | Reset the staging area without touching a DC. |
| `/push` | Register, push, and (if needed) unregister using the stacked data. | Executes the full DCShadow workflow automatically. |
| `/manualregister` | Only perform the registration phase. | Useful when you want to register now and push later. |
| `/manualpush` | Only push the already prepared data. | Lets you separate staging from replication. |
| `/manualunregister` | Explicitly unregister the rogue controller. | Cleans up without executing a full push. |
| `/addentry` | Directly call `DRSAddEntry` with the stacked object(s). | Adds replication data without starting the listener. |
| `/viewreplication` | Start the server but merely observe incoming replication requests. | Good for debugging the payload that real controllers send. |
| `/kill:<DN>` | Trigger lingering object cleanup against the provided DN. | Removes lingering objects after a push or as a standalone operation. |
| `/config`, `/schema`, `/root` | Select which naming contexts are synchronized during a push. | Restrict replication to configuration or schema partitions, or default to the domain NC when `/root` (explicitly or implicitly) is set. |
| `/domain:<fqdn>` | Override the domain used to discover metadata. | Necessary when operating outside the current logon domain. |
| `/dc:<fqdn>` | Choose the legitimate domain controller to impersonate. | Ensures LDAP and RPC calls are directed to the intended host. |
| `/computer:<NetBIOS>` | Set the NetBIOS name for the fake DC (defaults to the local hostname). | Prevents name collisions or helps impersonate a specific server. |
| `/object`, `/attribute`, `/value` | Define the attribute data to stage when used with `/stack` or `/addentry`. | Supplies the actual modifications that DCShadow will replicate. |
| `/multiple` | Allow multiple values for the same attribute. | Needed when adding multi-valued attributes. |
| `/clean` | Remove an object or attribute from the stack instead of adding it. | Correct staging mistakes without rebuilding the whole stack. |
| `/replOriginatingUid`, `/replOriginatingUsn`, `/replOriginatingTime` | Set custom replication metadata. | Craft precise replication provenance for advanced scenarios. |
| `/dynamic` | Mark the object as dynamic. | Required when staging dynamic objects such as DNS records. |
| `/remotemodify` | (with `/addentry`) allow remote modification semantics. | Permits updates that would otherwise be rejected. |

Once connected to LDAP the command gathers schema, domain, and controller metadata, encodes the
stacked changes, and executes the requested workflow (registration, push, lingering cleanup, etc.).【F:mimikatz/modules/lsadump/kuhl_m_lsadump_dc.c†L1018-L1313】【F:mimikatz/modules/lsadump/kuhl_m_lsadump_dc.c†L2840-L3008】

## `lsadump::setntlm`
Directly sets the NTLM hash (and optionally the LM hash) for an account in SAM.

| Flag | Purpose | Why use it |
| --- | --- | --- |
| `/password:<string>` | Derive the NTLM hash from a clear-text password. | Convenient when you know the password. |
| `/ntlm:<hex>` | Supply a 16-byte NTLM hash directly. | Use when you already have the hash. |
| `/user:<name>` or `/rid:<rid>` | Select the account to modify. | Required to identify the SAM user. |
| `/server:<hostname>` | Target a remote SAM server. | Enables editing passwords on another machine. |

If no credentials are provided the command uses a default known hash, making the account revert to a
predictable password for later logon.【F:mimikatz/modules/kuhl_m_lsadump.c†L2128-L2176】【F:mimikatz/modules/kuhl_m_lsadump.c†L2229-L2295】

## `lsadump::changentlm`
Invokes the SAM password change RPC, supplying both the current and the desired password material.

| Flag | Purpose | Why use it |
| --- | --- | --- |
| `/oldpassword:<string>` or `/oldntlm:<hex>` | Provide the current credentials. | Required so SAM will authorize the change. |
| `/newpassword:<string>` or `/newntlm:<hex>` | Provide the new credentials. | Defines the replacement password. |
| `/user:<name>` or `/rid:<rid>` | Select the account. | Mandatory target selector. |
| `/server:<hostname>` | Point to a remote SAM server. | Allows remote password changes over SAMR. |

If the old or new credentials are omitted the command reuses the built-in default hash, which can be
useful for quickly forcing known values onto machine accounts.【F:mimikatz/modules/kuhl_m_lsadump.c†L2168-L2238】【F:mimikatz/modules/kuhl_m_lsadump.c†L2239-L2295】

## `lsadump::netsync`
Speaks the Netlogon protocol to retrieve current and previous NTLM hashes for domain controllers or
servers.

| Flag | Purpose | Why use it |
| --- | --- | --- |
| `/dc:<fqdn>` | Target the domain controller. | Mandatory because Netlogon is a server-to-server protocol. |
| `/user:<account>` | Authenticate as the specified machine or domain account. | Required to build the Netlogon credential chain. |
| `/account:<name>` | Override the account whose passwords are requested (defaults to `/user`). | Allows querying trust accounts different from the authenticating identity. |
| `/computer:<NetBIOS>` | Provide the client computer name (defaults to `mimikatz`). | Needed when emulating a specific workstation. |
| `/ntlm:<hex>` | Supply the current NTLM hash for the authenticating account. | Required to derive the Netlogon session key. |

RPC connection modifiers (`/remote`, `/protseq`, `/service`, `/endpoint`, `/noauth`, `/ntlm`,
`/kerberos`, `/negotiate`, `/null`, `/authuser`, `/authdomain`, `/authpassword`) are also available
through the shared helper when finer control over the transport is needed.【F:mimikatz/modules/kuhl_m_lsadump.c†L2013-L2073】【F:modules/rpc/kull_m_rpc.c†L147-L215】

## `lsadump::packages`
Enumerates installed SSPI packages and optionally runs an outbound authentication sequence to obtain
the first token buffer.

| Argument | Purpose | Why use it |
| --- | --- | --- |
| `[target]` | Optional SPN or target name passed to `InitializeSecurityContext`. | Use to observe the initial blob a package sends during authentication. |

Each package is listed with capabilities, maximum token size, RPC ID, and version. When a target is
provided the command acquires outbound credentials and prints the produced token in hexadecimal so
it can be replayed or analyzed.【F:mimikatz/modules/kuhl_m_lsadump.c†L2356-L2393】

## `lsadump::mbc`
Displays the machine-bound certificate (MBC) material stored in the registry.

| Flag | Purpose | Why use it |
| --- | --- | --- |
| `/system:<path>` | Load an offline SYSTEM hive. | Necessary when dumping MBC data from a copied hive. |

Without parameters the command reads the local machine’s registry to locate the
`MachineBoundCertificate` blob and prints it via the DPAPI helper routines.【F:mimikatz/modules/kuhl_m_lsadump.c†L2395-L2444】

## `lsadump::zerologon`
Tests or exploits CVE-2020-1472 against a domain controller’s Netlogon service.

| Flag | Purpose | Why use it |
| --- | --- | --- |
| `/account:<DC$>` | Specify the target machine account. | Mandatory to craft the challenge/response sequence. |
| `/type:<id>` | Override the secure channel type (default: server). | Needed when attacking trust relationships instead of DC accounts. |
| `/exploit` | Switch from detection mode to actively resetting the password to zeroes. | Use cautiously when you intend to take over the target account. |

RPC binding options from the helper (`/remote`, `/protseq`, `/service`, `/endpoint`, `/noauth`,
`/ntlm`, `/kerberos`, `/negotiate`, `/null`, `/authuser`, `/authdomain`, `/authpassword`) are
available to reach the Netlogon endpoint under different transport conditions.【F:mimikatz/modules/kuhl_m_lsadump.c†L2470-L2590】【F:modules/rpc/kull_m_rpc.c†L147-L215】

## `lsadump::postzerologon`
Resets a domain controller’s machine account password and stored secret after a successful
ZeroLogon-style takeover.

| Flag | Purpose | Why use it |
| --- | --- | --- |
| `/target:<hostname>` | Domain controller whose password should be reset. | Required to open the right SAM and LSA handles. |
| `/account:<DC$>` | Machine account name that should receive the new password. | Identifies which machine account to fix. |

The command first changes the SAM password to a known constant and then updates the `$MACHINE.ACC`
LSA secret so the controller and the domain stay in sync.【F:mimikatz/modules/kuhl_m_lsadump.c†L2562-L2638】
