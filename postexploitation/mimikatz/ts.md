---
title: Mimikatz::TS
description: Terminal Server (ts) module documentation
published: true
date: 2025-10-08T16:39:03.518Z
tags: mimikatz
editor: markdown
dateCreated: 2025-10-08T16:39:03.518Z
---

# Mimikatz::TS

Terminal Server (`ts`) Module Documentation

The `ts` module in mimikatz provides tooling around Remote Desktop Services (Terminal Services).
Each command is invoked from the mimikatz console with the `ts::` prefix.

## Command Summary

| Command | Description |
| --- | --- |
| `ts::multirdp` | Experimental in-memory patch that enables multiple concurrent interactive sessions on a Remote Desktop Session Host. |
| `ts::sessions` | Enumerates Terminal Services sessions on the local or a remote host. |
| `ts::remote` | Initiates a shadow/remote-control connection into an existing session. |
| `ts::logonpasswords` | Experimental memory scanner that extracts credentials from the `TermService` process. |
| `ts::mstsc` | Experimental scanner that extracts cached connection properties (including secrets) from running `mstsc.exe` clients. |

---

## `ts::multirdp`

**Purpose:** Patch `termsrv.dll` in the running Terminal Services process so the host allows multiple users to log in simultaneously without enforcing single-session restrictions.【F:mimikatz/modules/kuhl_m_ts.c†L10-L48】

**Usage:**

```text
ts::multirdp
```

**Flags:** This command does not accept flags. It automatically detects the OS build and applies the matching patch in-memory. Use it when you need concurrent RDP sessions for administrative workflows or testing.

**Operational notes:**

* Requires administrative rights to modify the `TermService` process memory.
* Changes are not persistent across service or system restarts.
* Because the patch is experimental, validate functionality and system stability in a lab before production use.

---

## `ts::sessions`

**Purpose:** Enumerate Remote Desktop sessions on a target host, including state, user context, connection times, lock status, and remote IP addresses.【F:mimikatz/modules/kuhl_m_ts.c†L50-L141】

**Usage:**

```text
ts::sessions [/server:<hostname>]
```

**Flags:**

| Flag | Description | Why you would use it |
| --- | --- | --- |
| `/server:<hostname>` | Connects to the specified remote server before enumerating sessions. Defaults to the local machine when omitted. | Use when you need to inventory sessions on a different host while executing mimikatz from another machine.【F:mimikatz/modules/kuhl_m_ts.c†L66-L79】 |

**Operational notes:**

* Marks the current session with `*` when running locally.【F:mimikatz/modules/kuhl_m_ts.c†L80-L97】
* Prints user and timing metadata along with lock state and IP addresses for each session.【F:mimikatz/modules/kuhl_m_ts.c†L91-L139】
* Requires permissions that allow `WinStationEnumerateW` and related APIs to query the target.

---

## `ts::remote`

**Purpose:** Request that Terminal Services connect (shadow) from one session into another, optionally authenticating with a password.【F:mimikatz/modules/kuhl_m_ts.c†L143-L178】

**Usage:**

```text
ts::remote /id:<sessionId> [/target:<sessionId|current>] [/password:<secret>]
```

**Flags:**

| Flag | Description | Why you would use it |
| --- | --- | --- |
| `/id:<sessionId>` | Identifies the source session you want to control. Required. | The API call cannot proceed without specifying which existing session will become the controller.【F:mimikatz/modules/kuhl_m_ts.c†L147-L153】 |
| `/target:<sessionId>` | Session to control. Defaults to the current session when omitted. | Allows you to shadow a specific remote session instead of whichever session you are currently in.【F:mimikatz/modules/kuhl_m_ts.c†L154-L160】 |
| `/password:<secret>` | Password used when the source session is password-protected. Defaults to an empty string. | Supplies credentials to avoid `ERROR_LOGON_FAILURE` when the source session requires authentication.【F:mimikatz/modules/kuhl_m_ts.c†L161-L171】 |

**Operational notes:**

* Displays the target relationship before attempting the connection for situational awareness.【F:mimikatz/modules/kuhl_m_ts.c†L165-L171】
* Reports authentication failures explicitly so you can avoid account lockouts.【F:mimikatz/modules/kuhl_m_ts.c†L169-L176】

---

## `ts::logonpasswords`

**Purpose:** Scan the memory of the `TermService` process to locate cached plaintext or protected credentials associated with active Remote Desktop sessions.【F:mimikatz/modules/kuhl_m_ts.c†L180-L307】

**Usage:**

```text
ts::logonpasswords
```

**Flags:** This command does not accept flags. It automatically opens the `TermService` process, maps its memory, and searches for credential structures.

**Operational notes:**

* Requires SeDebugPrivilege or equivalent rights to open and read the service process memory.【F:mimikatz/modules/kuhl_m_ts.c†L185-L207】
* Emits a warning because pattern-based scanning can yield false positives; verify outputs before acting on them.【F:mimikatz/modules/kuhl_m_ts.c†L200-L203】
* Decrypts DPAPI-protected secrets when possible (Windows 10 and later) and also inspects web credential structures.【F:mimikatz/modules/kuhl_m_ts.c†L229-L303】

---

## `ts::mstsc`

**Purpose:** Inspect running `mstsc.exe` (Remote Desktop Connection) client processes for cached connection properties and secrets.【F:mimikatz/modules/kuhl_m_ts.c†L309-L469】

**Usage:**

```text
ts::mstsc [/verbose]
```

**Flags:**

| Flag | Description | Why you would use it |
| --- | --- | --- |
| `/verbose` | Enables verbose tracing of each property block discovered in process memory. | Helps analysts understand context or troubleshoot parsing by printing internal offsets and metadata for every matched structure.【F:mimikatz/modules/kuhl_m_ts.c†L311-L360】【F:mimikatz/modules/kuhl_m_ts.c†L388-L434】 |

**Operational notes:**

* Only inspects 64-bit client processes when running on x64 to avoid WOW64 pointer mismatches.【F:mimikatz/modules/kuhl_m_ts.c†L332-L347】
* Looks for the `mstscax.dll` module to confirm the target process is an RDP client before scanning.【F:mimikatz/modules/kuhl_m_ts.c†L344-L354】
* Extracts human-readable properties like server name, username, domain, smart card reader, and decrypted passwords when available.【F:mimikatz/modules/kuhl_m_ts.c†L394-L463】
* Prints secrets decrypted via `CryptUnprotectMemory` when data is flagged as protected; otherwise falls back to hex output for unknown blobs.【F:mimikatz/modules/kuhl_m_ts.c†L435-L463】

---

### Privilege & Safety Considerations

* Many commands require local administrator privileges and SeDebugPrivilege to open service processes or other users' sessions.
* Exercise caution when using experimental features (`multirdp`, `logonpasswords`, `mstsc`) on production systems due to potential instability or incomplete parsing.

